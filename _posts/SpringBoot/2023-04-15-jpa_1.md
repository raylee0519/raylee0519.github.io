---
layout: single
title: "영속성 컨텍스트"

categories:
  - Springboot
---

스프링부트 프로젝트를 하다 영속성 개념이 매우 중요하다는 것을 들었다. <br>
이 기회에 영속성에 대해서 알아볼까 한다. <br>

## 영속성
JPA를 이해하는데 가장 중요한 개념으로 엔티티를 영구 저장하는 환경 <br>
어플리케이션과 DB사이에서 객체를 보관하는 가상의 DB같은 역할을 함. <br>

## 영속성 진행과정
서비스별로 하나의 EntityManager Factory가 존재하며 Entity Manager Factory에서 디비에 접근하는 트랜잭션이 생길 때 마다 <br>
쓰레드 별로 Entity Manager를 생성하여 영속성 컨텍스트에 접근한다!! <br>
EntityManager에 엔티티를 저장하거나 조회하면 EntityManager는 영속성 컨텍스트에 엔티티를 보관하고 관리한다. <br>
영속성 컨텍스트는 EntityManager를 생성할 때 만들어지며 EntityManager를 통해 영속성 컨텍스트에 접근하고 관리한다. <br>
다음 코드로 Entity를 영속성 컨텍스트에 저장할 수 있다. <br>
```java entityManager.persist(entity);```
Spring에서는 EntityManager를 주입하여 사용하면 같은 트렌잭션의 범위에 있는 EntityManager는 같은 영속성 컨텍스트에 접근한다. <br>
(J2EE와 같은 스프링 프레임워크 같은 컨테이너 환경은 Entity Manager와 영속성 컨텍스트의 관계가 N:1이 가능하다. 하지만 J2SE와 같은 환경은 1:1이다.)


## EntityManager
EntityManager는 영속성 컨텍스트 내에서 Entity들을 관리하고 있다. <br>
EntityManager는 JPA에서 제공하는 interface로 spring bean으로 등록되어 있어 Autowired로 사용할 수 있다. <br>
```java
@Autowired
private EntityManager entityManager;
```
Query Method, Simple JPA repository는 직접적으로 entityManager를 사용하지 않도록 한번 더 감싸준 것이다. <br>
spring jpa에서 제공하지 않는 기능을 사용하거나 특별한 문제가 있어서 별도로 customizing을 해야한다면 entityManager를 직접 받아서 처리한다. <br>
EntityManager는 Entity Cache를 갖고 있다. <br>



